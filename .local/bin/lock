#!/bin/bash

IMG_PATH=/tmp/lock.jpg

resolution="$(xdpyinfo | grep -P "\d+x\d+(?= pixels)" -o)"
width=${resolution/x*}
height=${resolution/*x}
offset=$(("$width" / 3))

center_X=$(("$offset" * 2 / 3))
center_Y=$(("$height" / 2))
radius=$(("$offset" / 4))
inner_radius=$(("$radius" - 10))
outer_radius=$(("$radius" + 10))
ringwidth=8

img=(
  convert
  -background "#272822"
  -font "MesloLGS-NF-Regular"

  -size "${offset}x${height}"
  xc:
  -stroke "#a1a1a1" -strokewidth "$ringwidth" -fill none

  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 10,70"
  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 80,100"
  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 105,130"
  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 150,200"
  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 210,230"
  -draw "ellipse $center_X,$center_Y $inner_radius,$inner_radius 245,350"

  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 0,30"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 50,100"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 110,200"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 205,215"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 225,235"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 250,300"
  -draw "ellipse $center_X,$center_Y $outer_radius,$outer_radius 315,360"

  "("
    -stroke none -fill "#a1a1a1"

    -gravity southwest
    -size "$(("$width" - "$offset"))x$(("$height" / 2))"
    -pointsize 100
    label:"Locked"

    -gravity northwest
    -size "$(("$width" - "$offset"))x$(("$height" / 2))"
    -pointsize 35
    label:"Type your password to continue"

    -append
  ")"

  +append
  "$IMG_PATH"
)

invis="00000000"
white="a1a1a1ff"

lock=(
  i3lock --nofork --image "$IMG_PATH"
  --indicator --keylayout 0 --clock
  --pass-media-keys --pass-screen-keys --pass-power-keys --pass-volume-keys
  --inside-color="$invis" --insidever-color="$invis" --insidewrong-color="$invis"
  --ring-color="$invis" --ringver-color="$invis" --ringwrong-color="$invis"
  --verif-color="$white" --wrong-color="$white"
  --layout-color="$white" --time-color="$white" --date-color="$white"
  --line-uses-inside
  --keyhl-color="$white" --bshl-color="$white"
  --separator-color="$invis"
  --ind-pos="$center_X":"$center_Y"
  --radius="$radius" --ring-width="$ringwidth"
)

"${img[@]}"
"${lock[@]}"
