# vim:cms=#%s:

set hidden
set number
set relativenumber
set incsearch

# Set shortcuts to most visited locations
map g/ cd /
map gA cd /usr/share/applications
map gB cd /usr/bin
map gG cd ~/Games
map gM cd /mnt
map ga cd ~/.local/share/applications
map gb cd ~/.local/bin
map gc cd ~/.config
map gd cd ~/Downloads
map ge cd /etc
map gh cd ~
map gl cd ~/.local
map gme cd /run/media
map gmn cd /mnt
map gmu cd ~/Music
map go cd /opt
map gp cd ~/Pictures
map gt cd /tmp
map gub cd /usr/bin
map gulo cd /usr/lib
map gulo cd /usr/local
map gush cd /usr/share
map gusr cd /usr
map gva cd /var
map gvi cd ~/Videos

cmd on-cd ${{
  # Set terminal title
  printf "\033]0; $(pwd | sed "s|$HOME|~|") - lf\007" > /dev/tty

  # Set number of columns in dynamically depending on terminal width
  w=$(tput cols)
  if [ $w -ge 120 ]; then
    lf -remote "send $id set ratios 1:2:3"
    lf -remote "send $id set preview"
  elif [ $w -ge 80 ]; then
    lf -remote "send $id set ratios 1:2"
    lf -remote "send $id set preview"
  else
    lf -remote "send $id set nopreview"
    lf -remote "send $id set ratios 1"
  fi
}}
on-cd

# Soft links
cmd link %{{
  set -- $(cat ~/.local/share/lf/files)
  shift
  if [ "$#" -lt 1 ]; then
    lf -remote "send $id echo no files to link"
    exit 0
  fi
  ln -s -t . -- "$@"
  rm ~/.local/share/lf/files
  lf -remote "send clear"
}}
map P :link
map L :link
map S :link

map D delete
map <esc> quit

# Create directory
cmd mkdir %mkdir -p "$@"
map ad push :mkdir<space>

# Create file
cmd touch %touch "$@"
map af push :touch<space>

# Open file
cmd open ${{
  xdg-open "$f"
}}
map <enter> :open

# Open file and ask which application to use
cmd ask-and-open ${{
  mimeo -d "$f" --show-all |
    sed '1d; s/\.desktop$//' |
    fzf --header="Opening $(basename "$f")..." |
    xargs -ro -I _ gtk-launch _ "$f"
}}
map o ask-and-open

# Extract archive
cmd extract !{{
  7z x "$f" -o"${f%.*}"
}}
map x extract

# Add to archive
cmd add-to-archive !{{
  if [ "$fs" = "" ]; then
    7z a "$f".7z "$f"
    exit 0
  fi
  set -- $(echo $fs)
  7z a "$(basename "$(pwd)").7z" "$@"
  lf -remote "send unselect"
}}
map aa add-to-archive
